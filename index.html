<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tushar Toolkit Pro</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load QR Code JS Library -->
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <!-- Load jsPDF Library for JPG to PDF conversion -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- Load PDF.js for PDF to JPG conversion -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        // Set workerSrc for pdf.js
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    </script>

    <!-- PWA: Web App Manifest -->
    <link rel="manifest" href="/manifest.json">
    <!-- PWA: Theme Color for Browser UI -->
    <meta name="theme-color" content="#3b82f6">

    <style>
        /* Custom styles for the Inter font and general body styling */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* Original Light gray background */
            color: #334155; /* Original Dark slate gray text */
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            /* Animation for initial page load */
            animation: fadeIn 0.8s ease-out;
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #e2e8f0;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #60a5fa; /* Original blue scrollbar */
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #3b82f6; /* Original darker blue hover */
        }

        /* Keyframe animation for fade-in effect */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Keyframe animation for header slide-down */
        @keyframes slideDown {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Apply slide-down to header */
        header {
            animation: slideDown 0.6s ease-out;
        }

        /* Tool Card hover effect - already has transform hover:-translate-y-1 */
        /* Adding a subtle shadow change for depth */
        .tool-card:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); /* Tailwind shadow-lg */
        }

        /* Button hover effect */
        .btn-primary:hover {
            transform: scale(1.02); /* Slightly larger */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); /* Tailwind shadow-md */
        }

        /* --- Dark Mode Styles --- */
        @media (prefers-color-scheme: dark) {
            body {
                background-color: #1a202c; /* Dark gray background */
                color: #e2e8f0; /* Light gray text */
            }
            .bg-white {
                background-color: #2d3748; /* Darker card background */
            }
            .text-gray-800 {
                color: #e2e8f0; /* Light gray headings */
            }
            .text-gray-600 {
                color: #cbd5e0; /* Lighter gray text */
            }
            .text-gray-700 {
                color: #e2e8f0;
            }
            .text-gray-500 {
                color: #a0aec0;
            }
            .border-gray-300 {
                border-color: #4a5568;
            }
            .bg-gray-50 {
                background-color: #2d3748;
            }
            input, textarea, select {
                background-color: #2d3748 !important;
                color: #e2e8f0 !important;
                border-color: #4a5568 !important;
            }
            input::placeholder, textarea::placeholder {
                color: #a0aec0 !important; /* Placeholder text color */
            }
            .btn-primary {
                filter: brightness(1.2); /* Make buttons stand out slightly more on dark mode */
            }
            ::-webkit-scrollbar-track {
                background: #4a5568;
            }
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">
    <!-- Header Section -->
    <header class="bg-gradient-to-r from-blue-600 to-purple-700 text-white p-6 shadow-lg">
        <div class="container mx-auto flex flex-col md:flex-row justify-between items-center">
            <h1 class="text-4xl font-extrabold mb-2 md:mb-0">Tushar Toolkit Pro</h1>
            <nav>
                <ul class="flex space-x-6 text-lg">
                    <li><a href="#tools" class="hover:text-blue-200 transition duration-300">Tools</a></li>
                    <li><a href="#about" class="hover:text-blue-200 transition duration-300">About</a></li>
                    <li><a href="#contact" class="hover:text-blue-200 transition duration-300">Contact</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="container mx-auto p-8 flex-grow">
        <!-- Introduction Section -->
        <section class="text-center mb-12 bg-white p-8 rounded-xl shadow-md">
            <h2 class="text-3xl font-bold text-gray-800 mb-4">Your Go-To Hub for Everyday Utilities!</h2>
            <p class="text-lg text-gray-600 leading-relaxed">
                Welcome to Tushar Toolkit Pro, a collection of handy online tools designed to simplify your daily office tasks,
                from quick form fill-ups to essential data manipulation and image processing. We've got you covered.
            </p>
        </section>

        <!-- Tools Section -->
        <section id="tools" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-12">
            <!-- JPG to PDF Converter -->
            <div class="bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition duration-300 transform hover:-translate-y-1 tool-card">
                <h3 class="text-2xl font-semibold text-gray-800 mb-4">JPG to PDF Converter</h3>
                <input type="file" id="jpgInput" accept="image/jpeg,image/png" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4">
                <button onclick="convertJpgToPdf()" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 w-full mb-4 btn-primary">Convert to PDF</button>
                <div id="jpgToPdfStatus" class="text-sm text-gray-600 mb-2"></div>
                <a id="pdfDownloadLink" class="hidden bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 w-full text-center btn-primary" download="converted.pdf">Download PDF</a>
            </div>

            <!-- Image Resizer -->
            <div class="bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition duration-300 transform hover:-translate-y-1 tool-card">
                <h3 class="text-2xl font-semibold text-gray-800 mb-4">Image Resizer</h3>
                <input type="file" id="imageResizeInput" accept="image/*" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4">

                <div class="mb-4">
                    <label for="resizeUnitSelect" class="block text-gray-700 text-sm font-bold mb-2">Units:</label>
                    <select id="resizeUnitSelect" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="px">Pixels (px)</option>
                        <option value="cm">Centimeters (cm)</option>
                    </select>
                </div>

                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <label for="resizeWidth" class="block text-gray-700 text-sm font-bold mb-2">New Width:</label>
                        <input type="number" id="resizeWidth" placeholder="Original" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label for="resizeHeight" class="block text-gray-700 text-sm font-bold mb-2">New Height:</label>
                        <input type="number" id="resizeHeight" placeholder="Original" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                </div>

                <div class="mb-4" id="resizeDpiContainer">
                    <label for="resizeDPI" class="block text-gray-700 text-sm font-bold mb-2">DPI (Dots Per Inch):</label>
                    <input type="number" id="resizeDPI" min="1" value="300" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <p class="text-xs text-gray-500 mt-1">
                        DPI is for calculating pixel dimensions from CM. Browsers do not embed DPI metadata into output image files.
                        The output image will have the specified pixel dimensions regardless of its original DPI.
                    </p>
                </div>

                <label class="inline-flex items-center mb-4">
                    <input type="checkbox" id="resizeMaintainAspectRatio" checked class="form-checkbox h-5 w-5 text-blue-600 rounded">
                    <span class="ml-2 text-gray-700">Maintain Aspect Ratio</span>
                </label>
                <button onclick="processImageResize()" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 w-full mb-4 btn-primary">Resize Image</button>
                <div id="imageResizeStatus" class="text-sm text-gray-600 mb-2"></div>
                <a id="imageResizeDownloadLink" class="hidden bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 w-full text-center btn-primary" download="resized_image.png">Download Resized Image</a>
                <canvas id="imageResizeCanvas" class="hidden"></canvas> <!-- Hidden canvas for image processing -->
            </div>

            <!-- Image Compressor -->
            <div class="bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition duration-300 transform hover:-translate-y-1 tool-card">
                <h3 class="text-2xl font-semibold text-gray-800 mb-4">Image Compressor</h3>
                <input type="file" id="imageCompressInput" accept="image/*" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4">
                
                <div class="mb-4">
                    <label for="compressQualityNumber" class="block text-gray-700 text-sm font-bold mb-2">Quality (1-100):</label>
                    <input type="number" id="compressQualityNumber" min="1" max="100" value="80" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>

                <div class="mb-4">
                    <label for="compressTargetKbSize" class="block text-gray-700 text-sm font-bold mb-2">Target File Size (KB) (Optional):</label>
                    <input type="number" id="compressTargetKbSize" min="1" placeholder="Leave blank for quality-based" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <p class="text-xs text-gray-500 mt-1">Attempts to reach this size by adjusting quality (may not be exact).</p>
                </div>

                <div class="mb-4">
                    <label for="compressOutputFormatSelect" class="block text-gray-700 text-sm font-bold mb-2">Output Format:</label>
                    <select id="compressOutputFormatSelect" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="original">Same as Original</option>
                        <option value="jpeg">JPEG (Lossy Compression)</option>
                        <option value="webp">WebP (Modern Compression)</option>
                    </select>
                </div>
                <button onclick="processImageCompress()" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 w-full mb-4 btn-primary">Compress Image</button>
                <div id="imageCompressStatus" class="text-sm text-gray-600 mb-2"></div>
                <a id="imageCompressDownloadLink" class="hidden bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 w-full text-center btn-primary" download="compressed_image.png">Download Compressed Image</a>
                <canvas id="imageCompressCanvas" class="hidden"></canvas> <!-- Hidden canvas for image processing -->
            </div>

            <!-- Image Format Converter -->
            <div class="bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition duration-300 transform hover:-translate-y-1 tool-card">
                <h3 class="text-2xl font-semibold text-gray-800 mb-4">Image Format Converter</h3>
                <input type="file" id="imageFormatInput" accept="image/*" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4">
                
                <div class="mb-4">
                    <label for="formatOutputSelect" class="block text-gray-700 text-sm font-bold mb-2">Convert To:</label>
                    <select id="formatOutputSelect" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="image/jpeg">JPEG</option>
                        <option value="image/png">PNG</option>
                        <option value="image/webp">WebP</option>
                    </select>
                </div>
                <button onclick="convertImageFormat()" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 w-full mb-4 btn-primary">Convert Format</button>
                <div id="imageFormatStatus" class="text-sm text-gray-600 mb-2"></div>
                <a id="imageFormatDownloadLink" class="hidden bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 w-full text-center btn-primary" download="converted_image.jpeg">Download Converted Image</a>
                <canvas id="imageFormatCanvas" class="hidden"></canvas>
            </div>

            <!-- Rotate Image -->
            <div class="bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition duration-300 transform hover:-translate-y-1 tool-card">
                <h3 class="text-2xl font-semibold text-gray-800 mb-4">Rotate Image</h3>
                <input type="file" id="imageRotateInput" accept="image/*" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4">
                
                <div class="mb-4">
                    <label for="rotateAngle" class="block text-gray-700 text-sm font-bold mb-2">Rotation Angle:</label>
                    <select id="rotateAngle" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="90">90° Clockwise</option>
                        <option value="-90">90° Counter-Clockwise</option>
                        <option value="180">180°</option>
                    </select>
                </div>
                <button onclick="rotateImage()" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 w-full mb-4 btn-primary">Rotate Image</button>
                <div id="imageRotateStatus" class="text-sm text-gray-600 mb-2"></div>
                <a id="imageRotateDownloadLink" class="hidden bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 w-full text-center btn-primary" download="rotated_image.png">Download Rotated Image</a>
                <canvas id="imageRotateCanvas" class="hidden"></canvas>
            </div>

            <!-- Crop Image -->
            <div class="bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition duration-300 transform hover:-translate-y-1 tool-card">
                <h3 class="text-2xl font-semibold text-gray-800 mb-4">Crop Image</h3>
                <input type="file" id="imageCropInput" accept="image/*" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4">
                
                <p class="text-sm text-gray-600 mb-2">Enter crop coordinates (pixels):</p>
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <label for="cropX" class="block text-gray-700 text-sm font-bold mb-2">X:</label>
                        <input type="number" id="cropX" value="0" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label for="cropY" class="block text-gray-700 text-sm font-bold mb-2">Y:</label>
                        <input type="number" id="cropY" value="0" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label for="cropWidth" class="block text-gray-700 text-sm font-bold mb-2">Width:</label>
                        <input type="number" id="cropWidth" placeholder="Original Width" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label for="cropHeight" class="block text-gray-700 text-sm font-bold mb-2">Height:</label>
                        <input type="number" id="cropHeight" placeholder="Original Height" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                </div>
                <button onclick="cropImage()" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 w-full mb-4 btn-primary">Crop Image</button>
                <div id="imageCropStatus" class="text-sm text-gray-600 mb-2"></div>
                <a id="imageCropDownloadLink" class="hidden bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 w-full text-center btn-primary" download="cropped_image.png">Download Cropped Image</a>
                <canvas id="imageCropCanvas" class="hidden"></canvas>
            </div>

            <!-- PDF to JPG Converter -->
            <div class="bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition duration-300 transform hover:-translate-y-1 tool-card">
                <h3 class="text-2xl font-semibold text-gray-800 mb-4">PDF to JPG Converter</h3>
                <input type="file" id="pdfToJpgInput" accept="application/pdf" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4">
                <button onclick="convertPdfToJpg()" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 w-full mb-4 btn-primary">Convert PDF to JPG</button>
                <div id="pdfToJpgStatus" class="text-sm text-gray-600 mb-2"></div>
                <div id="pdfToJpgOutput" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Converted JPGs will appear here -->
                </div>
            </div>

            <!-- Unit Converter -->
            <div class="bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition duration-300 transform hover:-translate-y-1 tool-card">
                <h3 class="text-2xl font-semibold text-gray-800 mb-4">Unit Converter</h3>
                <input type="number" id="unitInputValue" placeholder="Value to convert" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4">
                
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <label for="unitFrom" class="block text-gray-700 text-sm font-bold mb-2">From Unit:</label>
                        <select id="unitFrom" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <optgroup label="Length">
                                <option value="meters">Meters</option>
                                <option value="feet">Feet</option>
                                <option value="inches">Inches</option>
                                <option value="cm">Centimeters</option>
                            </optgroup>
                            <optgroup label="Weight">
                                <option value="kg">Kilograms</option>
                                <option value="lbs">Pounds</option>
                                <option value="grams">Grams</option>
                            </optgroup>
                            <optgroup label="Temperature">
                                <option value="celsius">Celsius</option>
                                <option value="fahrenheit">Fahrenheit</option>
                                <option value="kelvin">Kelvin</option>
                            </optgroup>
                        </select>
                    </div>
                    <div>
                        <label for="unitTo" class="block text-gray-700 text-sm font-bold mb-2">To Unit:</label>
                        <select id="unitTo" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <optgroup label="Length">
                                <option value="meters">Meters</option>
                                <option value="feet">Feet</option>
                                <option value="inches">Inches</option>
                                <option value="cm">Centimeters</option>
                            </optgroup>
                            <optgroup label="Weight">
                                <option value="kg">Kilograms</option>
                                <option value="lbs">Pounds</option>
                                <option value="grams">Grams</option>
                            </optgroup>
                            <optgroup label="Temperature">
                                <option value="celsius">Celsius</option>
                                <option value="fahrenheit">Fahrenheit</option>
                                <option value="kelvin">Kelvin</option>
                            </optgroup>
                        </select>
                    </div>
                </div>
                <button onclick="convertUnit()" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 w-full mb-4 btn-primary">Convert Unit</button>
                <div id="unitOutput" class="p-3 border border-gray-300 rounded-lg bg-gray-50 text-gray-800 min-h-[50px] flex items-center justify-center">
                    Converted value will appear here.
                </div>
            </div>

            <!-- Text Find and Replace -->
            <div class="bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition duration-300 transform hover:-translate-y-1 tool-card">
                <h3 class="text-2xl font-semibold text-gray-800 mb-4">Text Find and Replace</h3>
                <textarea id="findReplaceInput" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4" rows="5" placeholder="Paste your text here..."></textarea>
                
                <div class="mb-4">
                    <label for="findText" class="block text-gray-700 text-sm font-bold mb-2">Find:</label>
                    <input type="text" id="findText" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div class="mb-4">
                    <label for="replaceText" class="block text-gray-700 text-sm font-bold mb-2">Replace With:</label>
                    <input type="text" id="replaceText" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <button onclick="findAndReplaceText()" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 w-full mb-4 btn-primary">Replace All</button>
                <textarea id="findReplaceOutput" class="w-full p-3 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500" rows="5" readonly placeholder="Result will appear here..."></textarea>
                <button onclick="copyToClipboard('findReplaceOutput')" class="mt-4 bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 w-full btn-primary">Copy Output</button>
            </div>

            <!-- CSV to JSON / JSON to CSV Converter -->
            <div class="bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition duration-300 transform hover:-translate-y-1 tool-card">
                <h3 class="text-2xl font-semibold text-gray-800 mb-4">CSV & JSON Converter</h3>
                <textarea id="csvJsonInput" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4" rows="8" placeholder="Paste CSV or JSON here..."></textarea>
                <div class="flex flex-wrap gap-2 mb-4">
                    <button onclick="convertCsvToJson()" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 btn-primary">CSV to JSON</button>
                    <button onclick="convertJsonToCsv()" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 btn-primary">JSON to CSV</button>
                </div>
                <textarea id="csvJsonOutput" class="w-full p-3 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500" rows="8" readonly placeholder="Converted output will appear here..."></textarea>
                <button onclick="copyToClipboard('csvJsonOutput')" class="mt-4 bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 w-full btn-primary">Copy Output</button>
            </div>


            <!-- Text Case Converter -->
            <div class="bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition duration-300 transform hover:-translate-y-1 tool-card">
                <h3 class="text-2xl font-semibold text-gray-800 mb-4">Text Case Converter</h3>
                <textarea id="caseInput" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4" rows="5" placeholder="Enter your text here..."></textarea>
                <div class="flex flex-wrap gap-2 mb-4">
                    <button onclick="convertCase('uppercase')" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 btn-primary">UPPERCASE</button>
                    <button onclick="convertCase('lowercase')" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 btn-primary">lowercase</button>
                    <button onclick="convertCase('capitalize')" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 btn-primary">Capitalize Words</button>
                    <button onclick="convertCase('sentence')" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 btn-primary">Sentence case</button>
                </div>
                <textarea id="caseOutput" class="w-full p-3 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500" rows="5" readonly placeholder="Converted text will appear here..."></textarea>
                <button onclick="copyToClipboard('caseOutput')" class="mt-4 bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 w-full btn-primary">Copy Output</button>
            </div>

            <!-- Word & Character Counter -->
            <div class="bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition duration-300 transform hover:-translate-y-1 tool-card">
                <h3 class="text-2xl font-semibold text-gray-800 mb-4">Word & Character Counter</h3>
                <textarea id="counterInput" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4" rows="5" placeholder="Type or paste your text here to count..."></textarea>
                <div class="flex justify-between text-lg font-medium text-gray-700">
                    <span>Words: <span id="wordCount" class="font-bold text-blue-600">0</span></span>
                    <span>Characters: <span id="charCount" class="font-bold text-blue-600">0</span></span>
                </div>
            </div>

            <!-- JSON Formatter & Validator -->
            <div class="bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition duration-300 transform hover:-translate-y-1 tool-card">
                <h3 class="text-2xl font-semibold text-gray-800 mb-4">JSON Formatter & Validator</h3>
                <textarea id="jsonInput" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4" rows="5" placeholder="Paste JSON here..."></textarea>
                <div class="flex flex-wrap gap-2 mb-4">
                    <button onclick="formatJson()" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 btn-primary">Format JSON</button>
                    <button onclick="validateJson()" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 btn-primary">Validate JSON</button>
                </div>
                <textarea id="jsonOutput" class="w-full p-3 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500" rows="5" readonly placeholder="Formatted/Validation result will appear here..."></textarea>
                <button onclick="copyToClipboard('jsonOutput')" class="mt-4 bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 w-full btn-primary">Copy Output</button>
            </div>

            <!-- Text Line Operations -->
            <div class="bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition duration-300 transform hover:-translate-y-1 tool-card">
                <h3 class="text-2xl font-semibold text-gray-800 mb-4">Text Line Operations</h3>
                <textarea id="textLinesInput" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4" rows="5" placeholder="Enter lines of text..."></textarea>
                <div class="flex flex-wrap gap-2 mb-4">
                    <button onclick="sortLines()" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 btn-primary">Sort Lines (A-Z)</button>
                    <button onclick="removeDuplicateLines()" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 btn-primary">Remove Duplicates</button>
                </div>
                <textarea id="textLinesOutput" class="w-full p-3 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500" rows="5" readonly placeholder="Result will appear here..."></textarea>
                <button onclick="copyToClipboard('textLinesOutput')" class="mt-4 bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 w-full btn-primary">Copy Output</button>
            </div>

            <!-- QR Code Generator -->
            <div class="bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition duration-300 transform hover:-translate-y-1 tool-card">
                <h3 class="text-2xl font-semibold text-gray-800 mb-4">QR Code Generator</h3>
                <textarea id="qrInput" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4" rows="5" placeholder="Enter text or URL to generate QR code..."></textarea>
                <button onclick="generateQRCode()" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 w-full mb-4 btn-primary">Generate QR Code</button>
                <div id="qrcode" class="flex justify-center items-center p-4 border border-gray-300 rounded-lg bg-gray-50">
                    <!-- QR code will be rendered here -->
                </div>
                <a id="qrDownloadLink" class="hidden bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 w-full text-center mt-4 btn-primary" download="qrcode.jpeg">Download QR Code</a>
                <p class="text-sm text-gray-500 mt-2 text-center">Right-click or long-press on the QR code to save it (alternative).</p>
            </div>
        </section>

        <!-- About Section -->
        <section id="about" class="bg-white p-8 rounded-xl shadow-md mb-12">
            <h2 class="text-3xl font-bold text-gray-800 mb-4">About Tushar Toolkit Pro</h2>
            <p class="text-lg text-gray-600 leading-relaxed">
                Tushar Toolkit Pro is your go-to online platform for essential office utilities. We aim to empower users
                with efficient solutions for daily tasks, enhancing productivity and simplifying complex digital needs.
                We're committed to continuous improvement and expanding our toolkit based on your feedback. More tools are coming soon!
            </p>
        </section>

        <!-- Contact Section -->
        <section id="contact" class="bg-white p-8 rounded-xl shadow-md">
            <h2 class="text-3xl font-bold text-gray-800 mb-4">Get in Touch</h2>
            <p class="text-lg text-gray-600 mb-4">
                Have suggestions, feedback, or need support? Feel free to reach out to us!
            </p>
            <p class="text-lg font-semibold text-blue-600">Email: <a href="mailto:evltushar@gmail.com" class="hover:underline">evltushar@gmail.com</a></p>
        </section>
    </main>

    <!-- Footer Section -->
    <footer class="bg-gray-800 text-white p-6 text-center mt-auto">
        <div class="container mx-auto">
            <p>&copy; <span id="currentYear"></span> Tushar Toolkit Pro. All rights reserved.</p>
            <p class="text-sm text-gray-400 mt-2">
                Disclaimer: This website is for informational and utility purposes. While we strive for accuracy,
                we do not guarantee the results of any tool or accept liability for its use.
                Users are solely responsible for ensuring their use of the tools complies with all applicable laws and regulations,
                including copyright and Digital Millennium Copyright Act (DMCA) guidelines. We do not endorse or support
                the unauthorized copying or distribution of copyrighted material, nor do we assume responsibility for any
                misuse of the tools or any consequences arising from such misuse.
            </p>
            <div class="mt-2 text-sm">
                <a href="/privacy.html" class="text-blue-300 hover:text-blue-100 transition duration-300">Privacy Policy</a>
                <span class="mx-2">|</span>
                <a href="/terms.html" class="text-blue-300 hover:text-blue-100 transition duration-300">Terms and Conditions</a>
            </div>
        </div>
    </footer>

    <script>
        // PWA: Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                // Correct pathing for the service worker
                navigator.serviceWorker.register('./service-worker.js')
                    .then(registration => {
                        console.log('ServiceWorker registration successful with scope: ', registration.scope);
                    })
                    .catch(err => {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
        }

        // Set current year in the footer
        document.getElementById('currentYear').textContent = new Date().getFullYear();

        /**
         * Copies text from a specified textarea or input element to the clipboard.
         * @param {string} elementId - The ID of the element to copy from.
         */
        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                element.select();
                element.setSelectionRange(0, 99999); // For mobile devices
                try {
                    document.execCommand('copy');
                    // In a real app, you might show a temporary "Copied!" message instead of console.log
                    console.log('Text copied to clipboard!');
                } catch (err) {
                    console.error('Failed to copy text: ', err);
                    // Fallback for browsers where execCommand is not supported or fails
                    // Using a simple alert for demonstration; consider a custom modal in a full app.
                    alert('Copying to clipboard is not supported in your browser or failed. Please copy manually.');
                }
            }
        }

        /* --- Text Case Converter Functions --- */

        /**
         * Converts the text in 'caseInput' textarea to a specified case and displays it in 'caseOutput'.
         * @param {string} caseType - The type of case conversion ('uppercase', 'lowercase', 'capitalize', 'sentence').
         */
        function convertCase(caseType) {
            const inputElement = document.getElementById('caseInput');
            const outputElement = document.getElementById('caseOutput');
            let text = inputElement.value;
            let convertedText = '';

            switch (caseType) {
                case 'uppercase':
                    convertedText = text.toUpperCase();
                    break;
                case 'lowercase':
                    convertedText = text.toLowerCase();
                    break;
                case 'capitalize':
                    // Capitalizes the first letter of each word
                    convertedText = text.replace(/\b\w/g, char => char.toUpperCase());
                    break;
                case 'sentence':
                    // Capitalizes the first letter of each sentence, handling multiple sentences
                    convertedText = text.toLowerCase().replace(/(^\s*\w|[.!?]\s*\w)/g, char => char.toUpperCase());
                    break;
                default:
                    convertedText = text;
            }
            outputElement.value = convertedText;
        }

        /* --- Word & Character Counter Functions --- */

        const counterInput = document.getElementById('counterInput');
        const wordCountSpan = document.getElementById('wordCount');
        const charCountSpan = document.getElementById('charCount');

        /**
         * Updates the word and character counts based on the input textarea.
         */
        function updateCounts() {
            const text = counterInput.value;
            charCountSpan.textContent = text.length;

            // Count words: split by whitespace and filter out empty strings
            const words = text.trim().split(/\s+/).filter(word => word.length > 0);
            wordCountSpan.textContent = words.length;
        }

        // Add event listener to update counts on input
        counterInput.addEventListener('input', updateCounts);
        // Initial call to set counts if there's pre-filled text
        updateCounts();

        /* --- JSON Formatter & Validator Functions --- */

        /**
         * Formats the JSON input for readability.
         */
        function formatJson() {
            const inputElement = document.getElementById('jsonInput');
            const outputElement = document.getElementById('jsonOutput');
            try {
                const jsonObject = JSON.parse(inputElement.value);
                outputElement.value = JSON.stringify(jsonObject, null, 2); // Pretty print with 2 spaces
            } catch (e) {
                outputElement.value = 'Error: Invalid JSON. Please check your input.';
                console.error('JSON Format Error:', e);
            }
        }

        /**
         * Validates if the input is a valid JSON string.
         */
        function validateJson() {
            const inputElement = document.getElementById('jsonInput');
            const outputElement = document.getElementById('jsonOutput');
            try {
                JSON.parse(inputElement.value);
                outputElement.value = 'Success: Valid JSON!';
                outputElement.style.color = 'green'; // Visual feedback for success
            } catch (e) {
                outputElement.value = `Error: Invalid JSON. ${e.message}`;
                outputElement.style.color = 'red'; // Visual feedback for error
                console.error('JSON Validation Error:', e);
            } finally {
                // Reset color after a short delay or next input
                setTimeout(() => { outputElement.style.color = ''; }, 3000);
            }
        }

        /* --- Text Line Operations Functions --- */

        /**
         * Sorts lines of text alphabetically.
         */
        function sortLines() {
            const inputElement = document.getElementById('textLinesInput');
            const outputElement = document.getElementById('textLinesOutput');
            const lines = inputElement.value.split('\n');
            lines.sort();
            outputElement.value = lines.join('\n');
        }

        /**
         * Removes duplicate lines from the text.
         */
        function removeDuplicateLines() {
            const inputElement = document.getElementById('textLinesInput');
            const outputElement = document.getElementById('textLinesOutput');
            const lines = inputElement.value.split('\n');
            const uniqueLines = [...new Set(lines)]; // Using Set to get unique values
            outputElement.value = uniqueLines.join('\n');
        }

        /* --- QR Code Generator Functions --- */

        let qrcodeInstance = null; // To store the QR code instance

        /**
         * Generates a QR code from the input text/URL.
         */
        function generateQRCode() {
            const qrInput = document.getElementById('qrInput').value;
            const qrcodeDiv = document.getElementById('qrcode');
            const qrDownloadLink = document.getElementById('qrDownloadLink');

            // Clear previous QR code and hide download link
            qrcodeDiv.innerHTML = '';
            qrDownloadLink.classList.add('hidden');
            qrDownloadLink.href = '#'; // Reset href

            if (qrInput.trim() === '') {
                qrcodeDiv.textContent = 'Please enter text or a URL to generate a QR code.';
                return;
            }

            try {
                // Create new QR code instance
                qrcodeInstance = new QRCode(qrcodeDiv, {
                    text: qrInput,
                    width: 200,
                    height: 200,
                    colorDark : "#000000",
                    colorLight : "#ffffff",
                    correctLevel : QRCode.CorrectLevel.H // High error correction
                });

                // After a short delay to allow QR code to render, get its data URL
                setTimeout(() => {
                    const qrCanvas = qrcodeDiv.querySelector('canvas');
                    if (qrCanvas) {
                        qrDownloadLink.href = qrCanvas.toDataURL('image/jpeg'); // Get as JPEG
                        qrDownloadLink.download = `qrcode_${Date.now()}.jpeg`; // Unique filename
                        qrDownloadLink.classList.remove('hidden');
                    } else {
                        // Fallback for older browsers or if canvas isn't immediately available
                        qrDownloadLink.href = '#'; // No download link if canvas not found
                        qrDownloadLink.classList.add('hidden');
                    }
                }, 100); // Small delay
            } catch (e) {
                qrcodeDiv.textContent = 'Error generating QR code. Please check your input.';
                console.error('QR Code Generation Error:', e);
            }
        }

        /* --- JPG to PDF Converter Functions --- */

        /**
         * Converts a selected JPG/PNG image to a PDF.
         */
        async function convertJpgToPdf() {
            const jpgInput = document.getElementById('jpgInput');
            const statusDiv = document.getElementById('jpgToPdfStatus');
            const downloadLink = document.getElementById('pdfDownloadLink');

            statusDiv.textContent = '';
            downloadLink.classList.add('hidden');
            downloadLink.href = '#';

            if (jpgInput.files.length === 0) {
                statusDiv.textContent = 'Please select an image file.';
                return;
            }

            const file = jpgInput.files[0];
            if (!file.type.startsWith('image/jpeg') && !file.type.startsWith('image/png')) {
                statusDiv.textContent = 'Please select a JPG or PNG image file.';
                return;
            }

            statusDiv.textContent = 'Converting image to PDF...';

            const reader = new FileReader();
            reader.onload = function(event) {
                const imgData = event.target.result;
                const img = new Image();
                img.onload = function() {
                    try {
                        // Initialize jsPDF
                        const { jsPDF } = window.jspdf;
                        const pdf = new jsPDF({
                            orientation: img.width > img.height ? 'landscape' : 'portrait',
                            unit: 'px',
                            format: [img.width, img.height] // Set PDF page size to image size
                        });

                        // Add the image to the PDF
                        pdf.addImage(imgData, 'JPEG', 0, 0, img.width, img.height);

                        // Generate PDF data URL
                        const pdfDataUri = pdf.output('datauristring');

                        downloadLink.href = pdfDataUri;
                        downloadLink.download = `${file.name.split('.')[0]}.pdf`;
                        downloadLink.classList.remove('hidden');
                        statusDiv.textContent = 'PDF generated successfully!';
                    } catch (e) {
                        statusDiv.textContent = `Error during PDF conversion: ${e.message}`;
                        console.error('PDF Conversion Error:', e);
                    }
                };
                img.onerror = function() {
                    statusDiv.textContent = 'Could not load image.';
                };
                img.src = imgData;
            };
            reader.onerror = function() {
                statusDiv.textContent = 'Error reading file.';
            };
            reader.readAsDataURL(file);
        }

        /* --- Image Resizer Functions --- */

        const CM_PER_INCH = 2.54; // 1 inch = 2.54 cm

        // Toggle DPI input visibility based on unit selection for Image Resizer
        document.getElementById('resizeUnitSelect').addEventListener('change', function() {
            const dpiContainer = document.getElementById('resizeDpiContainer');
            if (this.value === 'cm') {
                dpiContainer.classList.remove('hidden');
            } else {
                dpiContainer.classList.add('hidden');
            }
        });

        /**
         * Resizes a selected image based on user-defined dimensions and DPI.
         */
        async function processImageResize() {
            const imageInput = document.getElementById('imageResizeInput');
            let newWidthInput = document.getElementById('resizeWidth');
            let newHeightInput = document.getElementById('resizeHeight');
            const unitSelect = document.getElementById('resizeUnitSelect');
            const imageDPIInput = document.getElementById('resizeDPI');
            const maintainAspectRatio = document.getElementById('resizeMaintainAspectRatio').checked;
            const statusDiv = document.getElementById('imageResizeStatus');
            const downloadLink = document.getElementById('imageResizeDownloadLink');
            const canvas = document.getElementById('imageResizeCanvas');
            const ctx = canvas.getContext('2d');

            statusDiv.textContent = '';
            downloadLink.classList.add('hidden');
            downloadLink.href = '#';

            if (imageInput.files.length === 0) {
                statusDiv.textContent = 'Please select an image file.';
                return;
            }

            const file = imageInput.files[0];
            if (!file.type.startsWith('image/')) {
                statusDiv.textContent = 'Please select an image file.';
                return;
            }

            statusDiv.textContent = 'Resizing image...';

            const reader = new FileReader();
            reader.onload = function(event) {
                const img = new Image();
                img.onload = async function() {
                    let originalWidth = img.width;
                    let originalHeight = img.height;

                    let targetWidth = newWidthInput.value ? parseFloat(newWidthInput.value) : originalWidth;
                    let targetHeight = newHeightInput.value ? parseFloat(newHeightInput.value) : originalHeight;
                    let dpi = parseInt(imageDPIInput.value);

                    // Convert CM to Pixels if selected
                    if (unitSelect.value === 'cm') {
                        if (isNaN(dpi) || dpi <= 0) {
                            statusDiv.textContent = 'Please enter a valid DPI value (greater than 0) for CM units.';
                            return;
                        }
                        if (newWidthInput.value) targetWidth = (targetWidth / CM_PER_INCH) * dpi;
                        if (newHeightInput.value) targetHeight = (targetHeight / CM_PER_INCH) * dpi;
                    }

                    if (maintainAspectRatio) {
                        const aspectRatio = originalWidth / originalHeight;
                        if (newWidthInput.value && !newHeightInput.value) {
                            targetHeight = targetWidth / aspectRatio;
                        } else if (!newWidthInput.value && newHeightInput.value) {
                            targetWidth = targetHeight * aspectRatio;
                        } else if (newWidthInput.value && newHeightInput.value) {
                            // If both are provided, fit within the box while maintaining aspect ratio
                            const targetAspectRatio = targetWidth / targetHeight;
                            if (aspectRatio > targetAspectRatio) {
                                targetHeight = targetWidth / aspectRatio;
                            } else {
                                targetWidth = targetHeight * aspectRatio;
                            }
                        }
                    }

                    // If no dimensions are provided, and not using CM, keep original dimensions
                    if (!newWidthInput.value && !newHeightInput.value && unitSelect.value === 'px') {
                        targetWidth = originalWidth;
                        targetHeight = originalHeight;
                    }


                    // Round dimensions to avoid fractional pixels
                    targetWidth = Math.round(targetWidth);
                    targetHeight = Math.round(targetHeight);

                    canvas.width = targetWidth;
                    canvas.height = targetHeight;
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.drawImage(img, 0, 0, targetWidth, targetHeight);

                    // Output as original type if possible, or PNG for lossless
                    let outputMimeType = file.type;
                    let outputExtension = file.name.split('.').pop().toLowerCase();

                    // If original is JPEG, keep it JPEG. Otherwise, default to PNG for lossless resize.
                    if (file.type !== 'image/jpeg' && file.type !== 'image/png' && file.type !== 'image/gif') {
                        outputMimeType = 'image/png';
                        outputExtension = 'png';
                    }


                    const resizedImageDataUrl = canvas.toDataURL(outputMimeType); // No quality parameter here for resize only
                    const response = await fetch(resizedImageDataUrl);
                    const blob = await response.blob();
                    const resizedSize = blob.size;

                    downloadLink.href = URL.createObjectURL(blob);
                    downloadLink.download = `resized_${file.name.split('.')[0]}.${outputExtension}`;
                    downloadLink.classList.remove('hidden');

                    statusDiv.innerHTML = `Image resized successfully!<br>
                                          Original Dimensions: ${originalWidth}x${originalHeight}px<br>
                                          New Dimensions: ${targetWidth}x${targetHeight}px<br>
                                          Output Format: <strong>${outputExtension.toUpperCase()}</strong><br>
                                          New File Size: <strong>${(resizedSize / 1024).toFixed(2)} KB</strong><br>
                                          <span style="color: blue; font-weight: bold;">Note: Browser-generated images do not embed DPI metadata. The DPI value you entered was used for pixel calculation only.</span>`;
                };
                img.onerror = function() {
                    statusDiv.textContent = 'Could not load image.';
                };
                img.src = event.target.result;
            };
            reader.onerror = function() {
                statusDiv.textContent = 'Error reading file.';
            };
            reader.readAsDataURL(file);
        }


        /* --- Image Compressor Functions --- */

        /**
         * Compresses a selected image by adjusting quality and/or targeting a specific file size.
         */
        async function processImageCompress() {
            const imageInput = document.getElementById('imageCompressInput');
            const qualityInput = document.getElementById('compressQualityNumber');
            const targetKbSizeInput = document.getElementById('compressTargetKbSize');
            const outputFormatSelect = document.getElementById('compressOutputFormatSelect');
            const statusDiv = document.getElementById('imageCompressStatus');
            const downloadLink = document.getElementById('imageCompressDownloadLink');
            const canvas = document.getElementById('imageCompressCanvas');
            const ctx = canvas.getContext('2d');

            statusDiv.textContent = '';
            downloadLink.classList.add('hidden');
            downloadLink.href = '#';

            if (imageInput.files.length === 0) {
                statusDiv.textContent = 'Please select an image file.';
                return;
            }

            const file = imageInput.files[0];
            if (!file.type.startsWith('image/')) {
                statusDiv.textContent = 'Please select an image file.';
                return;
            }

            let quality = parseInt(qualityInput.value);
            if (isNaN(quality) || quality < 1 || quality > 100) {
                statusDiv.textContent = 'Please enter a valid quality value between 1 and 100.';
                qualityInput.value = 80; // Reset to default if invalid
                return;
            }

            let targetKb = parseInt(targetKbSizeInput.value);
            const useTargetKb = !isNaN(targetKb) && targetKb > 0;

            statusDiv.textContent = 'Compressing image...';

            const reader = new FileReader();
            reader.onload = function(event) {
                const img = new Image();
                img.onload = async function() {
                    canvas.width = img.width; // Use original dimensions for compression
                    canvas.height = img.height;
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.drawImage(img, 0, 0, img.width, img.height);

                    let outputMimeType;
                    let outputExtension;
                    const selectedOutputFormat = outputFormatSelect.value;

                    switch (selectedOutputFormat) {
                        case 'jpeg':
                            outputMimeType = 'image/jpeg';
                            outputExtension = 'jpeg';
                            break;
                        case 'webp':
                            outputMimeType = 'image/webp';
                            outputExtension = 'webp';
                            if (canvas.toDataURL('image/webp').indexOf('data:image/webp') < 0) {
                                console.warn('WebP output not supported by browser, falling back to JPEG.');
                                outputMimeType = 'image/jpeg';
                                outputExtension = 'jpeg';
                            }
                            break;
                        case 'original':
                        default:
                            outputMimeType = file.type;
                            outputExtension = file.name.split('.').pop().toLowerCase();
                            // If original is lossless and quality < 100, warn user
                            if ((file.type === 'image/png' || file.type === 'image/gif' || file.type === 'image/bmp') && quality < 100) {
                                statusDiv.innerHTML = `<span style="color: orange; font-weight: bold;">Note: For PNG/GIF/BMP, 'Quality' setting only applies if converted to JPEG/WebP. Select 'JPEG' or 'WebP' output for size reduction.</span><br>`;
                            }
                            break;
                    }

                    let finalBlob;
                    let finalQuality = quality;

                    if (useTargetKb && (outputMimeType === 'image/jpeg' || outputMimeType === 'image/webp')) {
                        // Iterative compression to hit target KB (approximate)
                        let low = 0;
                        let high = 100;
                        let mid = quality;
                        let currentBlob;
                        let currentSize;
                        const MAX_ITERATIONS = 15; // Increased iterations for better accuracy

                        for (let i = 0; i < MAX_ITERATIONS; i++) {
                            currentBlob = await new Promise(resolve => {
                                canvas.toBlob(resolve, outputMimeType, mid / 100);
                            });
                            currentSize = currentBlob.size / 1024; // in KB

                            statusDiv.textContent = `Compressing: Iteration ${i+1}/${MAX_ITERATIONS}, Quality: ${mid}, Size: ${currentSize.toFixed(2)} KB (Target: ${targetKb} KB)`;

                            if (Math.abs(currentSize - targetKb) < 5 || mid === low || mid === high) { // Within 5KB or converged
                                finalBlob = currentBlob;
                                finalQuality = mid;
                                break;
                            }

                            if (currentSize > targetKb) {
                                high = mid;
                            } else {
                                low = mid;
                            }
                            mid = Math.round((low + high) / 2);

                            if (i === MAX_ITERATIONS - 1) {
                                finalBlob = currentBlob;
                                finalQuality = mid;
                                statusDiv.textContent = `Compression finished. Best quality found: ${finalQuality}. Target KB may not be exact.`;
                            }
                        }
                    } else {
                        // Single pass compression (if no target KB or lossless format)
                        finalBlob = await new Promise(resolve => {
                            canvas.toBlob(resolve, outputMimeType, quality / 100);
                        });
                        finalQuality = quality;
                    }

                    const originalSize = file.size;
                    const optimizedSize = finalBlob.size;

                    downloadLink.href = URL.createObjectURL(finalBlob);
                    downloadLink.download = `compressed_${file.name.split('.')[0]}.${outputExtension}`;
                    downloadLink.classList.remove('hidden');

                    let feedbackMessage = `Image compressed successfully!<br>
                                          Original Dimensions: ${img.width}x${img.height}px<br>
                                          Output Format: <strong>${outputExtension.toUpperCase()}</strong> (Quality: ${finalQuality})<br>
                                          Original Size: <strong>${(originalSize / 1024).toFixed(2)} KB</strong><br>
                                          Optimized Size: <strong>${(optimizedSize / 1024).toFixed(2)} KB</strong>`;

                    if (useTargetKb && (outputMimeType === 'image/jpeg' || outputMimeType === 'image/webp')) {
                        const difference = Math.abs(optimizedSize / 1024 - targetKb);
                        if (difference > 5) {
                            feedbackMessage += `<br><span style="color: orange; font-weight: bold;">Note: Target size of ${targetKb} KB not precisely met. Achieved ${ (optimizedSize / 1024).toFixed(2)} KB. Try adjusting quality or dimensions.</span>`;
                        } else {
                            feedbackMessage += `<br><span style="color: green; font-weight: bold;">Target size of ${targetKb} KB achieved!</span>`;
                        }
                    } else if (optimizedSize > originalSize) {
                        feedbackMessage += `<br><span style="color: orange; font-weight: bold;">Note: The compressed file size is larger than the original. This can happen due to format conversion overhead (e.g., from highly optimized PNG to JPEG), or if the original image was already very small/simple.</span>`;
                    } else {
                        const percentageReduction = (((originalSize - optimizedSize) / originalSize) * 100).toFixed(2);
                        feedbackMessage += `<br><span style="color: green; font-weight: bold;">File size reduced by ${percentageReduction}%!</span>`;
                    }

                    statusDiv.innerHTML = feedbackMessage;
                };
                img.onerror = function() {
                    statusDiv.textContent = 'Could not load image.';
                };
                img.src = event.target.result;
            };
            reader.onerror = function() {
                statusDiv.textContent = 'Error reading file.';
            };
            reader.readAsDataURL(file);
        }

        /* --- New Tools Functions --- */

        /* Image Format Converter */
        async function convertImageFormat() {
            const imageInput = document.getElementById('imageFormatInput');
            const formatOutputSelect = document.getElementById('formatOutputSelect');
            const statusDiv = document.getElementById('imageFormatStatus');
            const downloadLink = document.getElementById('imageFormatDownloadLink');
            const canvas = document.getElementById('imageFormatCanvas');
            const ctx = canvas.getContext('2d');

            statusDiv.textContent = '';
            downloadLink.classList.add('hidden');
            downloadLink.href = '#';

            if (imageInput.files.length === 0) {
                statusDiv.textContent = 'Please select an image file.';
                return;
            }

            const file = imageInput.files[0];
            if (!file.type.startsWith('image/')) {
                statusDiv.textContent = 'Please select an image file.';
                return;
            }

            const targetMimeType = formatOutputSelect.value;
            const targetExtension = targetMimeType.split('/')[1];

            statusDiv.textContent = `Converting to ${targetExtension.toUpperCase()}...`;

            const reader = new FileReader();
            reader.onload = function(event) {
                const img = new Image();
                img.onload = async function() {
                    canvas.width = img.width;
                    canvas.height = img.height;
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.drawImage(img, 0, 0, img.width, img.height);

                    let imageDataUrl;
                    try {
                        imageDataUrl = canvas.toDataURL(targetMimeType);
                        // Check for WebP support fallback
                        if (targetMimeType === 'image/webp' && imageDataUrl.indexOf('data:image/webp') < 0) {
                            statusDiv.textContent = `WebP output not fully supported by your browser, falling back to PNG.`;
                            imageDataUrl = canvas.toDataURL('image/png');
                            downloadLink.download = `converted_image.png`;
                        } else {
                            downloadLink.download = `converted_image.${targetExtension}`;
                        }
                    } catch (e) {
                        statusDiv.textContent = `Error converting image: ${e.message}`;
                        console.error('Image Format Conversion Error:', e);
                        return;
                    }

                    const response = await fetch(imageDataUrl);
                    const blob = await response.blob();

                    downloadLink.href = URL.createObjectURL(blob);
                    downloadLink.classList.remove('hidden');
                    statusDiv.textContent = `Image converted to ${targetExtension.toUpperCase()} successfully!`;
                };
                img.onerror = function() {
                    statusDiv.textContent = 'Could not load image.';
                };
                img.src = event.target.result;
            };
            reader.onerror = function() {
                statusDiv.textContent = 'Error reading file.';
            };
            reader.readAsDataURL(file);
        }

        /* Rotate Image */
        async function rotateImage() {
            const imageInput = document.getElementById('imageRotateInput');
            const rotateAngle = parseInt(document.getElementById('rotateAngle').value);
            const statusDiv = document.getElementById('imageRotateStatus');
            const downloadLink = document.getElementById('imageRotateDownloadLink');
            const canvas = document.getElementById('imageRotateCanvas');
            const ctx = canvas.getContext('2d');

            statusDiv.textContent = '';
            downloadLink.classList.add('hidden');
            downloadLink.href = '#';

            if (imageInput.files.length === 0) {
                statusDiv.textContent = 'Please select an image file.';
                return;
            }

            const file = imageInput.files[0];
            if (!file.type.startsWith('image/')) {
                statusDiv.textContent = 'Please select an image file.';
                return;
            }

            statusDiv.textContent = `Rotating image by ${rotateAngle}°...`;

            const reader = new FileReader();
            reader.onload = function(event) {
                const img = new Image();
                img.onload = async function() {
                    let originalWidth = img.width;
                    let originalHeight = img.height;

                    // Calculate new dimensions after rotation
                    let newWidth, newHeight;
                    if (Math.abs(rotateAngle) === 90 || Math.abs(rotateAngle) === 270) {
                        newWidth = originalHeight;
                        newHeight = originalWidth;
                    } else {
                        newWidth = originalWidth;
                        newHeight = originalHeight;
                    }

                    canvas.width = newWidth;
                    canvas.height = newHeight;

                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.save();
                    ctx.translate(canvas.width / 2, canvas.height / 2);
                    ctx.rotate(rotateAngle * Math.PI / 180);
                    ctx.drawImage(img, -originalWidth / 2, -originalHeight / 2, originalWidth, originalHeight);
                    ctx.restore();

                    const rotatedImageDataUrl = canvas.toDataURL(file.type);
                    const response = await fetch(rotatedImageDataUrl);
                    const blob = await response.blob();

                    downloadLink.href = URL.createObjectURL(blob);
                    downloadLink.download = `rotated_${file.name}`;
                    downloadLink.classList.remove('hidden');
                    statusDiv.textContent = `Image rotated successfully!`;
                };
                img.onerror = function() {
                    statusDiv.textContent = 'Could not load image.';
                };
                img.src = event.target.result;
            };
            reader.onerror = function() {
                statusDiv.textContent = 'Error reading file.';
            };
            reader.readAsDataURL(file);
        }

        /* Crop Image */
        async function cropImage() {
            const imageInput = document.getElementById('imageCropInput');
            let cropX = parseInt(document.getElementById('cropX').value);
            let cropY = parseInt(document.getElementById('cropY').value);
            let cropWidth = parseInt(document.getElementById('cropWidth').value);
            let cropHeight = parseInt(document.getElementById('cropHeight').value);
            const statusDiv = document.getElementById('imageCropStatus');
            const downloadLink = document.getElementById('imageCropDownloadLink');
            const canvas = document.getElementById('imageCropCanvas');
            const ctx = canvas.getContext('2d');

            statusDiv.textContent = '';
            downloadLink.classList.add('hidden');
            downloadLink.href = '#';

            if (imageInput.files.length === 0) {
                statusDiv.textContent = 'Please select an image file.';
                return;
            }

            const file = imageInput.files[0];
            if (!file.type.startsWith('image/')) {
                statusDiv.textContent = 'Please select an image file.';
                return;
            }

            statusDiv.textContent = 'Cropping image...';

            const reader = new FileReader();
            reader.onload = function(event) {
                const img = new Image();
                img.onload = async function() {
                    // Use original dimensions if cropWidth/Height are not provided or invalid
                    cropWidth = isNaN(cropWidth) || cropWidth <= 0 ? img.width : cropWidth;
                    cropHeight = isNaN(cropHeight) || cropHeight <= 0 ? img.height : cropHeight;

                    // Ensure crop area is within image bounds
                    cropX = Math.max(0, Math.min(cropX, img.width - cropWidth));
                    cropY = Math.max(0, Math.min(cropY, img.height - cropHeight));
                    cropWidth = Math.min(cropWidth, img.width - cropX);
                    cropHeight = Math.min(cropHeight, img.height - cropY);

                    if (cropWidth <= 0 || cropHeight <= 0) {
                        statusDiv.textContent = 'Invalid crop dimensions. Please ensure width and height are positive and within image bounds.';
                        return;
                    }

                    canvas.width = cropWidth;
                    canvas.height = cropHeight;
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.drawImage(img, cropX, cropY, cropWidth, cropHeight, 0, 0, cropWidth, cropHeight);

                    const croppedImageDataUrl = canvas.toDataURL(file.type);
                    const response = await fetch(croppedImageDataUrl);
                    const blob = await response.blob();

                    downloadLink.href = URL.createObjectURL(blob);
                    downloadLink.download = `cropped_${file.name}`;
                    downloadLink.classList.remove('hidden');
                    statusDiv.innerHTML = `Image cropped successfully!<br>New Dimensions: ${cropWidth}x${cropHeight}px`;
                };
                img.onerror = function() {
                    statusDiv.textContent = 'Could not load image.';
                };
                img.src = event.target.result;
            };
            reader.onerror = function() {
                statusDiv.textContent = 'Error reading file.';
            };
            reader.readAsDataURL(file);
        }

        /* PDF to JPG Converter */
        async function convertPdfToJpg() {
            const pdfInput = document.getElementById('pdfToJpgInput');
            const statusDiv = document.getElementById('pdfToJpgStatus');
            const outputDiv = document.getElementById('pdfToJpgOutput');

            statusDiv.textContent = '';
            outputDiv.innerHTML = ''; // Clear previous images

            if (pdfInput.files.length === 0) {
                statusDiv.textContent = 'Please select a PDF file.';
                return;
            }

            const file = pdfInput.files[0];
            if (file.type !== 'application/pdf') {
                statusDiv.textContent = 'Please select a valid PDF file.';
                return;
            }

            statusDiv.textContent = 'Converting PDF to JPG(s)... This may take a moment.';

            const reader = new FileReader();
            reader.onload = async function(event) {
                const pdfData = new Uint8Array(event.target.result);
                try {
                    const loadingTask = pdfjsLib.getDocument({ data: pdfData });
                    const pdf = await loadingTask.promise;

                    for (let i = 1; i <= pdf.numPages; i++) {
                        const page = await pdf.getPage(i);
                        const viewport = page.getViewport({ scale: 1.5 }); // Adjust scale for higher resolution JPGs

                        const canvas = document.createElement('canvas');
                        const context = canvas.getContext('2d');
                        canvas.height = viewport.height;
                        canvas.width = viewport.width;

                        await page.render({ canvasContext: context, viewport: viewport }).promise;

                        const imgData = canvas.toDataURL('image/jpeg', 0.9); // Convert to JPEG with 90% quality

                        const imgElement = document.createElement('img');
                        imgElement.src = imgData;
                        imgElement.alt = `Page ${i}`;
                        imgElement.classList.add('w-full', 'rounded-lg', 'shadow-md'); // Tailwind classes for styling

                        const downloadLink = document.createElement('a');
                        downloadLink.href = imgData;
                        downloadLink.download = `${file.name.split('.')[0]}_page_${i}.jpeg`;
                        downloadLink.classList.add('bg-green-500', 'hover:bg-green-600', 'text-white', 'font-bold', 'py-2', 'px-4', 'rounded-lg', 'shadow-md', 'transition', 'duration-300', 'w-full', 'text-center', 'mt-2', 'block', 'btn-primary');
                        downloadLink.textContent = `Download Page ${i}`;

                        const pageContainer = document.createElement('div');
                        pageContainer.classList.add('p-4', 'bg-gray-100', 'rounded-lg');
                        pageContainer.appendChild(imgElement);
                        pageContainer.appendChild(downloadLink);
                        outputDiv.appendChild(pageContainer);
                    }
                    statusDiv.textContent = `Successfully converted ${pdf.numPages} page(s) to JPG!`;
                } catch (e) {
                    statusDiv.textContent = `Error converting PDF: ${e.message}`;
                    console.error('PDF to JPG Conversion Error:', e);
                }
            };
            reader.onerror = function() {
                statusDiv.textContent = 'Error reading PDF file.';
            };
            reader.readAsArrayBuffer(file);
        }

        /* Unit Converter */
        function convertUnit() {
            const inputValue = parseFloat(document.getElementById('unitInputValue').value);
            const fromUnit = document.getElementById('unitFrom').value;
            const toUnit = document.getElementById('unitTo').value;
            const outputDiv = document.getElementById('unitOutput');

            outputDiv.textContent = 'Converted value will appear here.'; // Reset output

            if (isNaN(inputValue)) {
                outputDiv.textContent = 'Please enter a valid number.';
                outputDiv.style.color = 'red';
                setTimeout(() => { outputDiv.style.color = ''; }, 3000);
                return;
            }

            let result;
            let error = false;

            // Conversion factors (to a common base unit first, then to target)
            const conversions = {
                // Length (base: meters)
                meters: { toMeters: 1, fromMeters: 1 },
                feet: { toMeters: 0.3048, fromMeters: 1 / 0.3048 },
                inches: { toMeters: 0.0254, fromMeters: 1 / 0.0254 },
                cm: { toMeters: 0.01, fromMeters: 100 },
                // Weight (base: kilograms)
                kg: { toKg: 1, fromKg: 1 },
                lbs: { toKg: 0.453592, fromKg: 1 / 0.453592 },
                grams: { toKg: 0.001, fromKg: 1000 },
                // Temperature (no simple base, handle separately)
                celsius: {},
                fahrenheit: {},
                kelvin: {}
            };

            // Check if units are compatible (e.g., cannot convert meters to kg)
            const getUnitGroup = (unit) => {
                if (['meters', 'feet', 'inches', 'cm'].includes(unit)) return 'length';
                if (['kg', 'lbs', 'grams'].includes(unit)) return 'weight';
                if (['celsius', 'fahrenheit', 'kelvin'].includes(unit)) return 'temperature';
                return null;
            };

            const fromGroup = getUnitGroup(fromUnit);
            const toGroup = getUnitGroup(toUnit);

            if (fromGroup !== toGroup) {
                outputDiv.textContent = 'Error: Incompatible unit types.';
                outputDiv.style.color = 'red';
                setTimeout(() => { outputDiv.style.color = ''; }, 3000);
                return;
            }

            if (fromGroup === 'temperature') {
                // Temperature conversions are non-linear
                if (fromUnit === 'celsius') {
                    if (toUnit === 'fahrenheit') result = (inputValue * 9/5) + 32;
                    else if (toUnit === 'kelvin') result = inputValue + 273.15;
                    else result = inputValue; // C to C
                } else if (fromUnit === 'fahrenheit') {
                    if (toUnit === 'celsius') result = (inputValue - 32) * 5/9;
                    else if (toUnit === 'kelvin') result = (inputValue - 32) * 5/9 + 273.15;
                    else result = inputValue; // F to F
                } else if (fromUnit === 'kelvin') {
                    if (toUnit === 'celsius') result = inputValue - 273.15;
                    else if (toUnit === 'fahrenheit') result = (inputValue - 273.15) * 9/5 + 32;
                    else result = inputValue; // K to K
                }
            } else {
                // Linear conversions
                if (fromGroup === 'length') {
                    const valueInMeters = inputValue * conversions[fromUnit].toMeters;
                    result = valueInMeters * conversions[toUnit].fromMeters;
                } else if (fromGroup === 'weight') {
                    const valueInKg = inputValue * conversions[fromUnit].toKg;
                    result = valueInKg * conversions[toUnit].fromKg;
                }
            }

            if (result !== undefined) {
                outputDiv.textContent = `${inputValue} ${fromUnit} = ${result.toFixed(4)} ${toUnit}`;
                outputDiv.style.color = 'green';
            } else {
                outputDiv.textContent = 'Conversion not possible or invalid input.';
                outputDiv.style.color = 'red';
            }
            setTimeout(() => { outputDiv.style.color = ''; }, 3000);
        }

        /* Text Find and Replace */
        function findAndReplaceText() {
            const inputText = document.getElementById('findReplaceInput').value;
            const findText = document.getElementById('findText').value;
            const replaceText = document.getElementById('replaceText').value;
            const outputElement = document.getElementById('findReplaceOutput');

            if (!findText) {
                outputElement.value = 'Please enter text to find.';
                return;
            }

            // Using a global regular expression to replace all occurrences
            const regex = new RegExp(findText, 'g');
            outputElement.value = inputText.replace(regex, replaceText);
        }

        /* CSV to JSON / JSON to CSV Converter */
        function convertCsvToJson() {
            const input = document.getElementById('csvJsonInput').value;
            const outputElement = document.getElementById('csvJsonOutput');
            try {
                const lines = input.split('\n').filter(line => line.trim() !== '');
                if (lines.length === 0) {
                    outputElement.value = 'No CSV data found.';
                    return;
                }

                const headers = lines[0].split(',').map(header => header.trim());
                const result = [];

                for (let i = 1; i < lines.length; i++) {
                    const values = lines[i].split(',').map(value => value.trim());
                    if (values.length !== headers.length) {
                        outputElement.value = `Error: Line ${i + 1} has an inconsistent number of columns.`;
                        return;
                    }
                    const obj = {};
                    for (let j = 0; j < headers.length; j++) {
                        obj[headers[j]] = values[j];
                    }
                    result.push(obj);
                }
                outputElement.value = JSON.stringify(result, null, 2);
            } catch (e) {
                outputElement.value = `Error converting CSV to JSON: ${e.message}`;
            }
        }

        function convertJsonToCsv() {
            const input = document.getElementById('csvJsonInput').value;
            const outputElement = document.getElementById('csvJsonOutput');
            try {
                const jsonArray = JSON.parse(input);
                if (!Array.isArray(jsonArray) || jsonArray.length === 0) {
                    outputElement.value = 'Invalid JSON array or empty.';
                    return;
                }

                const headers = Object.keys(jsonArray[0]);
                let csv = headers.join(',') + '\n';

                jsonArray.forEach(obj => {
                    const values = headers.map(header => {
                        let value = obj[header];
                        if (typeof value === 'string' && (value.includes(',') || value.includes('\n') || value.includes('"'))) {
                            value = `"${value.replace(/"/g, '""')}"`; // Handle commas, newlines, and quotes
                        }
                        return value;
                    });
                    csv += values.join(',') + '\n';
                });
                outputElement.value = csv;
            } catch (e) {
                outputElement.value = `Error converting JSON to CSV: ${e.message}`;
            }
        }

    </script>
</body>
</html>
